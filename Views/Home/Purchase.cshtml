@using Microsoft.Extensions.Options
@inject  IOptions<StripeSettings> Stripe
@{
    ViewData["Title"] = "Home Page";
}

    <div>

        <h2>Subscriptions</h2>

        @if (!(ViewBag.Subscriptions as IEnumerable<Stripe.Subscription>).Any())
        {
            <p>You have no current subscriptions</p>

            <button id="SubscribeButton" class="btn btn-primary">Subscribe</button>
        }
        else
        {
            <ul>
                @foreach (var subscription in ViewBag.Subscriptions)
                {
                    <li>@subscription.Id for Customer @subscription.Customer</li>
                }
            </ul>
        }
    </div>

@section scripts
{
    <script src="https://js.stripe.com/v3/"></script>

    <script type="text/javascript">

        document.addEventListener("DOMContentLoaded", function (event) {
           const stripe = Stripe('@Stripe.Value.PublicKey');

            const subscribeButton = document.getElementById('SubscribeButton');
            subscribeButton.addEventListener('click', () => {
                stripe.redirectToCheckout({
                  sessionId: '@ViewBag.CheckoutSessionId'
                }).then((result) => {
                  // If `redirectToCheckout` fails due to a browser or network
                  // error, display the localized error message to your customer
                  // using `result.error.message`.
                });
            })
        });

    </script>
}
